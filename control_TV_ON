function turnOnTVAndSetChannel() {
  const powerSignalId = "879a7467-b91f-40bb-808c-d00d5e5a7449"; // é›»æºONã®Signal ID
  const endpoint = "https://api.nature.global/1/signals/";
  const headers = {
    "Authorization": "Bearer " + REMO_ACCESS_TOKEN
  };

  // ãƒãƒ£ãƒ³ãƒãƒ«ç•ªå·ã”ã¨ã®ã‚·ã‚°ãƒŠãƒ«IDãƒãƒƒãƒ—ï¼ˆå„æ•°å­—ã«å¯¾ã™ã‚‹ã‚·ã‚°ãƒŠãƒ«ï¼‰
  const CHANNEL_SIGNAL_IDS = {
    "1": "5c6a0d47-143d-4c90-88f2-e1a9bc9136d0",
    "2": "73839962-2f21-44ee-9b68-a27ac079d810",
    "3": "406f1428-9fd7-4a00-93ab-912a402ab414",
    "4": "ec568624-863c-42e9-b954-17724e016390",
    "5": "56f9746e-8965-496c-bfa4-2170619245df",
    "6": "97642750-2eff-4c65-9ca0-eec383a3f062",
    "7": "67886395-4d10-46fc-8111-9d30d692355b",
    "8": "bebcfe05-6d87-4471-87c8-e7d2d4cba859",
    "9": "c9d75392-b539-4adb-8315-256dfa4f4748"
  };

  try {
    // 1. ãƒ†ãƒ¬ãƒ“ã®é›»æºã‚’ON
    UrlFetchApp.fetch(endpoint + powerSignalId + "/send", {
      "method": "POST",
      "headers": headers
    });
    Logger.log("ãƒ†ãƒ¬ãƒ“ã®é›»æºã‚’ã‚ªãƒ³ã«ã—ã¾ã—ãŸ");
    Utilities.sleep(7000);

    // 2. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®Eåˆ—ã®ã‚’å–å¾—
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    const columnValues = sheet.getRange("E:E").getValues();
    let lastValue = null;

    for (let i = 0; i < columnValues.length; i++) {
      if (columnValues[i][0] !== "") {
        lastValue = columnValues[i][0];
      }
    }

    const channel = String(lastValue);
    Logger.log("è¨­å®šã™ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«: " + channel);

    // 3. ãƒãƒ£ãƒ³ãƒãƒ«ç•ªå·ã‚’å…¥åŠ›
    for (let i = 0; i < channel.length; i++) {
      const digit = channel[i];
      const signalId = CHANNEL_SIGNAL_IDS[digit];
      if (signalId) {
        UrlFetchApp.fetch(endpoint + signalId + "/send", {
          "method": "POST",
          "headers": headers
        });
        Utilities.sleep(500); // 0.5ç§’å¾…æ©Ÿï¼ˆãƒ†ãƒ¬ãƒ“ãŒä¿¡å·ã‚’å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ï¼‰
      } else {
        Logger.log("æœªç™»éŒ²ã®æ•°å­—: " + digit);
      }
    }

    // 4. é€šçŸ¥ã¨ãƒ­ã‚°
    sendLineMessage(`ğŸ“º ãƒ†ãƒ¬ãƒ“ã‚’ã‚ªãƒ³ï¼†ãƒãƒ£ãƒ³ãƒãƒ«ã€Œ${channel}ã€ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ`);
    recordTVState(true);

  } catch (error) {
    Logger.log("ãƒ†ãƒ¬ãƒ“åˆ¶å¾¡ã‚¨ãƒ©ãƒ¼: " + error.message);
  }
}

function tv_current(result) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const aColumnValues = sheet.getRange("A:A").getValues();

  let aLastRow = 0;
  for (let i = 0; i < aColumnValues.length; i++) {
    if (aColumnValues[i][0] !== "") {
      aLastRow = i + 1;
    }
  }

  const valueToWrite = (result === 1) ? 1 : 0;
  sheet.getRange(aLastRow, 6).setValue(valueToWrite);
}

